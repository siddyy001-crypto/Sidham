<!doctype html>
<html lang="en">
<head>
  <meta name="google-site-verification" content="DBIPJgObjkOc9jcd_K0Yk9TQQiy_JM_smX6U6G_6Mf4" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sidham — Emergency Line</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Playfair+Display:wght@400;600;700;900&family=Merriweather:wght@300;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/gsap@3.12.2/dist/gsap.min.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

  <style>
    :root{
      /* royal gold + deep maroon palette */
      --bg1: #fff6f2;
      --bg2: #fff0ee;
      --royal: #5a203a;        /* deep maroon */
      --gold-1: #d4a017;
      --gold-2: #f3cf56;
      
      /* NEW: Liquid Glass & Embroidery settings */
      --glass-bg: linear-gradient(180deg, rgba(255,255,255,0.65), rgba(255,255,255,0.35));
      --glass-border: rgba(255, 255, 255, 0.7);
      --glass-shadow: 0 25px 50px -12px rgba(90,32,58,0.25);
      --embroidery-stitch: 2px dotted rgba(212,160,40,0.3);
      --blur: 20px; /* More blur for liquid glass */
    }

    *{box-sizing:border-box}
    html,body{
      height:100%;margin:0;font-family:Merriweather, 'Playfair Display', Cinzel, serif;
      background-color: var(--bg1);
      /* UPDATED: Added subtle 'carpet' weave texture */
      background-image:
        radial-gradient(900px 420px at 8% 8%, rgba(243,207,86,0.06), transparent),
        radial-gradient(700px 360px at 92% 92%, rgba(212,160,40,0.05), transparent),
        linear-gradient(180deg,var(--bg1),var(--bg2)),
        repeating-linear-gradient(45deg, rgba(90,32,58,0.01) 0, rgba(90,32,58,0.01) 1px, transparent 1px, transparent 6px); /* Weave */
      color:var(--royal); -webkit-font-smoothing:antialiased; overflow-x:hidden;
    }

    /* Stage (single column) */
    .stage{
      min-height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center;
      padding:28px 18px; gap:34px; position:relative; text-align:center; max-width:780px; margin:0 auto;
    }

    /* full-canvas background for animals + sparkles */
    canvas#particles{ position:absolute; inset:0; z-index:0; pointer-events:none; }

    .hero{ z-index:3; padding:10px 0; width:100%; display:flex; flex-direction:column; align-items:center; text-align:center; gap:8px }
    
    /* UPDATED: Logo changed from 'S' to 'Sidham' */
    .logo{
      width: auto; height: auto;
      padding: 18px 28px;
      border-radius:20px; overflow:hidden;
      box-shadow: 0 12px 40px rgba(90,32,58,0.12), inset 0 6px 18px rgba(255,230,180,0.18);
      border: 2px solid rgba(212,160,40,0.12);
      background: linear-gradient(180deg,#fff4f2,#ffefee);
      
      /* NEW: Gold Embroidery Effect */
      font-family:Cinzel, serif;
      font-size: 28px; 
      font-weight: 900;
      color: var(--gold-1);
      background: linear-gradient(180deg, #f3cf56, #d4a017);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 2px rgba(90,32,58,0.1), 0 0 0 rgba(255,240,200,0.5);
    }
    
    .brand { /* Removed the 'Private Access' text, so just center the logo */
      display:flex; justify-content:center;
    }

    h1{
      font-family:Cinzel, 'Playfair Display', serif; font-weight:700; font-size:36px; margin:6px 0 0;
      color:var(--royal);
      text-shadow: 0 6px 18px rgba(212,150,60,0.08), 0 1px 0 rgba(255,255,255,0.6) inset;
    }

    .glow-line{
      height:4px; width:160px; border-radius:40px;
      background: linear-gradient(90deg, rgba(212,160,40,0.95), rgba(243,207,86,0.85));
      box-shadow: 0 6px 30px rgba(243,207,86,0.12); margin:8px auto 0;
    }

    /* Card — UPDATED for Liquid Glass */
    .card-wrap{ z-index:4; width:100%; display:flex; justify-content:center }
    .card{
      width:100%; max-width:640px;
      background: var(--glass-bg);
      border-radius:26px; padding:30px; 
      border:1px solid var(--glass-border);
      backdrop-filter: blur(var(--blur)); 
      box-shadow: var(--glass-shadow);
      position:relative; overflow:visible;
    }

    /* UPDATED: Glass "bevel" edge instead of embroidered frame */
    .card:before{
      content:"";
      position:absolute; inset:-1px; border-radius:30px; pointer-events:none;
      box-shadow: inset 0 0 2px 0 rgba(255,255,255,0.8), 0 0 0 1px rgba(255,255,255,0.5);
    }

    .card h2{ font-family:Cinzel, serif; margin:0 0 14px; font-size:22px; color:var(--gold-1); text-align:center; text-transform:uppercase; letter-spacing:1px; text-shadow: 0 3px 0 rgba(0,0,0,0.06); }

    /* Felt/embroidered input row */
    .pwd-row{ 
      display:flex; gap:14px; align-items:center; 
      flex-direction:row; /* <<< CHANGED */
      margin-top:6px; 
    }
    
    /* NEW: Class to center button when unlocked */
    .pwd-row.unlocked {
      justify-content: center;
    }
    
    /* UPDATED: Stitched/Embroidery effect */
    input[type="password"]{
      width:100%; 
      flex: 1; /* <<< ADDED */
      padding:14px 18px; border-radius:22px; 
      background:
        repeating-linear-gradient(135deg, rgba(255,250,245,0.95) 0 6px, rgba(255,245,240,0.95) 6px 12px),
        linear-gradient(180deg,#fff7f6,#fff1ef);
      color:var(--royal); font-size:16px; outline:none;
      box-shadow: inset 0 8px 18px rgba(212,160,40,0.1), 0 1px 0 rgba(255,255,255,0.5); /* Soften shadow */
      font-family: 'Playfair Display', serif;
      border: var(--embroidery-stitch);
      /* NEW: Animation */
      transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease, opacity 0.5s ease; /* Added opacity */
    }
    
    /* NEW: Animation */
    input[type="password"]:focus {
      transform: scale(1.02);
      border-color: rgba(212,160,40,0.5);
      box-shadow: inset 0 8px 18px rgba(212,160,40,0.15), 0 1px 0 rgba(255,255,255,0.5), 0 0 20px rgba(212,160,40,0.2);
    }


    /* Hefty luxurious embroidered button */
    button.primary{
      width:auto; /* <<< CHANGED */
      padding:14px 18px; border-radius:22px; cursor:pointer;
      font-family:Cinzel, 'Playfair Display', serif; font-weight:700; letter-spacing:0.6px; text-transform:uppercase;
      background: linear-gradient(180deg, #f6d68a 0%, #d7a61b 60%, #c58f12 100%);
      color:#3a1d27; 
      box-shadow:
        inset 0 6px 14px rgba(255,255,255,0.6),
        0 10px 30px rgba(197,140,30,0.18),
        0 2px 0 rgba(0,0,0,0.08);
      border: 2px dotted rgba(255, 255, 255, 0.6); /* Stitched */
      transition: transform 0.18s ease, box-shadow 0.18s ease;
      /* margin-top: 14px; removed */
    }
    button.primary:active{ transform: translateY(1px) scale(0.995); box-shadow: 0 6px 18px rgba(197,140,30,0.16); }
    button.primary:hover{ transform: translateY(-4px); box-shadow: 0 18px 40px rgba(197,140,30,0.22); }

    .hint{ 
        font-size:13px; color:rgba(90,32,58,0.7); margin-top:12px; text-align:center; font-family: 'Playfair Display', serif; 
        display: flex; /* Make it a flex container */
        flex-direction: column; /* Stack items vertically */
        align-items: center; /* Center items horizontally */
    }
    .msg{ margin-top:12px;padding:10px;border-radius:10px;background:rgba(255,120,140,0.06); color:#8f2e4f; border:1px solid rgba(255,120,140,0.08); display:none; text-align:center; font-family:Merriweather, serif; }

    /* UPDATED: Glassier reveal box */
    .reveal{
      margin-top:18px;padding:18px;border-radius:18px;
      background: linear-gradient(180deg, rgba(255,248,240,0.85), rgba(255,245,240,0.7));
      border:1px solid rgba(255,245,230,0.7);
      min-height:110px; display:flex; flex-direction: column; align-items:center;
      box-shadow: inset 0 0 18px rgba(210,150,40,0.06);
    }

    .secret{ font-family:'Playfair Display'; font-size:15px; line-height:1.35; color:var(--royal); white-space:pre-line; text-shadow: 0 1px 0 rgba(255,255,255,0.5); }
    
    .msg-section {
      width: 100%;
      margin-bottom: 24px;
    }
    .msg-section:last-child { margin-bottom: 0; }
    .msg-section h3 {
      font-family: Cinzel, serif; margin: 0 0 10px; font-size: 18px; color: var(--gold-1);
      text-align: center; text-transform: uppercase; letter-spacing: 1px;
      text-shadow: 0 2px 0 rgba(0,0,0,0.04);
    }

    /* --- STYLES FOR DOTS --- */
    .status-dots {
        display: flex; gap: 20px; margin-top: 8px; font-family: 'Playfair Display', serif;
        font-size: 14px; color: var(--royal); transition: opacity 0.3s ease;
    }
    .status-item { display: flex; align-items: center; gap: 5px; }
    .dot {
      display: inline-block; width: 8px; height: 8px; border-radius: 50%;
      background-color: #d9534f; /* Red */
      box-shadow: 0 0 5px rgba(217, 83, 79, 0.4);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    .dot.green {
      background-color: #5cb85c; /* Green */
      box-shadow: 0 0 8px rgba(92, 184, 92, 0.6);
    }

    .editable{
      background: linear-gradient(180deg,#fff8ef,#fff4ee); 
      border: var(--embroidery-stitch); /* Stitched */
      border-radius:12px; padding:8px 12px;
      color:var(--royal); font-family:'Playfair Display'; font-size:15px; outline:none;
      box-shadow: inset 0 6px 12px rgba(255,240,220,0.35);
      width: 100%; /* <<< CHANGED */
    }

    /* UPDATED: Stitched Send button */
    .save-btn{
      padding:8px 14px; border-radius:12px; cursor:pointer;
      background: linear-gradient(180deg,#ffe5b9,#ffd37a);
      color:#3a1d27; font-weight:700;
      box-shadow: 0 8px 24px rgba(197,140,30,0.16);
      font-family: Cinzel, serif;
      text-transform: uppercase; letter-spacing: 0.5px;
      border: 2px dashed rgba(197,140,30,0.5); /* Stitched */
      width: auto; /* <<< CHANGED */
    }
    .save-btn:hover{ transform:scale(1.03) }
    
    /* NEW: Input row for message sections */
    .input-row {
      display: flex;
      flex-direction: row; /* <<< CHANGED */
      gap: 10px;
      align-items: center;
      margin-top: 10px;
      width: 100%;
      max-width: 420px; /* Constrain width */
      margin-left: auto;
      margin-right: auto;
    }
    .input-row .editable {
      width: 100%;
      flex: 1; /* <<< ADDED */
      margin-top: 0;
    }
    .input-row .save-btn {
      width: auto; /* <<< CHANGED */
      margin-top: 0;
    }
    /* --- End Input Row --- */

    .typing-caret{ border-right:3px solid rgba(212,160,40,0.95); padding-right:4px; }

    @media(min-width:900px){
      .stage{ padding:40px 32px; gap:48px }
      h1{ font-size:44px }
      /* pwd-row and input are now default, so only padding override is needed */
      button.primary{ padding:14px 28px }
      
      /* Only padding override is needed */
      .input-row .save-btn {
        padding: 8px 20px;
      }
    }
    @media (max-width:480px){ 
      h1{ font-size:30px }
      /* On very small screens, make "Go Ahead" less wide */
      button.primary { padding-left: 14px; padding-right: 14px; }
    }

    .spark { position:absolute; pointer-events:none; z-index:6; filter: drop-shadow(0 8px 18px rgba(212,150,40,0.18)); border-radius:50%; }
  </style>
</head>
<body>
  <div class="stage">
    <canvas id="particles"></canvas>

    <div class="hero">
      <div class="brand">
        <div class="logo">Sidham</div>
      </div>

      <h1 id="title">Welcome to Sidham</h1>
      <div class="glow-line" aria-hidden="true"></div>
      <p class="lead" style="display:none"></p>
    </div>

    <div class="card-wrap">
      <div class="card" role="form" aria-labelledby="title">
        <h2>EMERGENCY LINE</h2>

        <div class="pwd-row">
          <input id="pwd" type="password" inputmode="text" placeholder="Enter Contact No." aria-label="Password" />
          <button id="submit" class="primary">Go Ahead</button>
        </div>

        <div class="hint">
          SOS
          <div class="status-dots" id="status-dots-container">
            <div class="status-item">
              <span class="dot" id="dot-sid"></span> BEBAAA
            </div>
            <div class="status-item">
              <span class="dot" id="dot-samaira"></span> SID
            </div>
          </div>
        </div>
        <div class="msg" id="msg">Enter correct Contact No. Try again.</div>

        <div class="reveal">
          <div class="secret" id="secret" style="opacity:0;transform:translateY(8px); width:100%;"></div>
        </div>
      </div>
    </div>

  </div>

  <script>
    // ---------- Firebase config (sidham) ----------
    const firebaseConfig = {
      apiKey: "AIzaSyBSMypTNkkeH4hgtKIonNOccRC1-jRiRZg",
      authDomain: "sidham-6d564.firebaseapp.com",
      databaseURL: "https://sidham-6d564-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "sidham-6d564",
      storageBucket: "sidham-6d564.firebasestorage.app",
      messagingSenderId: "1002306011366",
      appId: "1:1002306011366:web:ce0477d82ecb4baa697b27",
      measurementId: "G-F981VH4MYM"
    };
    try { 
      firebase.initializeApp(firebaseConfig); 
    } catch (e) { /* already initialized? */ }
    
    const db = firebase.database();
    const auth = firebase.auth(); // NEW: Get auth service
    const dbRef = db.ref('passwordMessage');

    // ---------- constants & elements ----------
    // NEW: This is the shared email you created in Firebase
    const SHARED_EMAIL = 'shonsk0010@gmail.com'; // <<< *** THIS IS THE FIX ***
    
    // REMOVED: const CORRECT = '0010'; // This is no longer needed!
    
    const pwd = document.getElementById('pwd');
    const btn = document.getElementById('submit');
    const msg = document.getElementById('msg');
    const secretEl = document.getElementById('secret');
    const pwdRow = document.querySelector('.pwd-row'); // Get the password row container

    const dotSid = document.getElementById('dot-sid');
    const dotSamaira = document.getElementById('dot-samaira');
    const statusDotsContainer = document.getElementById('status-dots-container');

    function typeWriterEffect(text, element, delay = 40, callback) {
      element.textContent = '';
      element.classList.add('typing-caret');
      let i = 0;
      const step = () => {
        if (i < text.length) {
          element.textContent += text.charAt(i);
          i++;
          setTimeout(step, delay);
        } else {
          element.classList.remove('typing-caret');
          if (callback) callback();
        }
      };
      step();
    }

    // --- Firebase Helpers (No changes here) ---
    async function fetchSidData() {
      try {
        const snap = await db.ref('passwordMessage/sid').get();
        if (snap && snap.exists()) { return snap.val(); } 
        else {
          const defaultData = { msg: 'Sid= Default Sid Message', status: 'read' };
          await db.ref('passwordMessage/sid').set(defaultData);
          return defaultData;
        }
      } catch (e) {
        console.error('Firebase fetch error (Sid)', e);
        return { msg: 'Sid= Error loading message', status: 'read' };
      }
    }
    
    async function fetchSamairaData() {
      try {
        const snap = await db.ref('passwordMessage/samaira').get();
        if (snap && snap.exists()) { return snap.val(); } 
        else {
          const defaultData = { msg: 'Samaira= Default Samaira Message', status: 'read' };
          await db.ref('passwordMessage/samaira').set(defaultData);
          return defaultData;
        }
      } catch (e) {
        console.error('Firebase fetch error (Samaira)', e);
        return { msg: 'Samaira= Error loading message', status: 'read' };
      }
    }
    
    async function saveSidMsg(value) {
      try {
        await db.ref('passwordMessage/sid').update({ msg: value, status: 'read' });
        await db.ref('passwordMessage/samaira').update({ status: 'unread' }); // Mark other user
        return true;
      } catch (e) { console.error('Firebase save error (Sid)', e); return false; }
    }
    
    async function saveSamairaMsg(value) {
      try {
        await db.ref('passwordMessage/samaira').update({ msg: value, status: 'read' });
        await db.ref('passwordMessage/sid').update({ status: 'unread' }); // Mark other user
        return true;
      } catch (e) { console.error('Firebase save error (Samaira)', e); return false; }
    }

    // --- Realtime Listener (for dots) ---
    // UPDATED: This listener will now *only* work if you are NOT logged in
    auth.onAuthStateChanged(user => {
      if (!user) {
        // Not logged in, check for dots
        dbRef.on('value', (snapshot) => {
          const data = snapshot.val();
          if (!data) return;
          const sidData = data.sid || {};
          if (sidData.status === 'unread') { dotSid.classList.add('green'); } 
          else { dotSid.classList.remove('green'); }
          
          const samairaData = data.samaira || {};
          if (samairaData.status === 'unread') { dotSamaira.classList.add('green'); } 
          else { dotSamaira.classList.remove('green'); }
        });
      }
    });

    // ---------- REBUILT showSecret function ----------
    async function showSecret() {
      msg.style.display = 'none';
      statusDotsContainer.style.display = 'none'; // Hide dots
      
      gsap.to(secretEl, { opacity: 1, y: 0, duration: 0.9, ease: 'power3.out' });
      secretEl.textContent = ''; 

      const sidData = await fetchSidData();
      const samairaData = await fetchSamairaData();

      // Mark messages as "read" on login
      if (sidData.status === 'unread') { db.ref('passwordMessage/sid').update({ status: 'read' }); }
      if (samairaData.status === 'unread') { db.ref('passwordMessage/samaira').update({ status: 'read' }); }

      // --- Create Sid's Section ---
      const sidSection = document.createElement('div');
      sidSection.className = 'msg-section';
      const sidTitle = document.createElement('h3');
      sidTitle.textContent = "SID'S LINE";
      sidSection.appendChild(sidTitle);
      const sidDisplay = document.createElement('div');
      sidDisplay.className = 'secret';
      sidDisplay.id = 'sid-display';
      sidSection.appendChild(sidDisplay);
      secretEl.appendChild(sidSection);

      // --- Create Samaira's Section ---
      const samairaSection = document.createElement('div');
      samairaSection.className = 'msg-section';
      const samairaTitle = document.createElement('h3');
      samairaTitle.textContent = "SAMAIRA'S LINE";
      samairaSection.appendChild(samairaTitle);
      const samairaDisplay = document.createElement('div');
      samairaDisplay.className = 'secret';
      samairaDisplay.id = 'samaira-display';
      samairaSection.appendChild(samairaDisplay);
      secretEl.appendChild(samairaSection);
      
      // 1. Type for Sid
      typeWriterEffect(sidData.msg, sidDisplay, 30, () => {
        // NEW: Create input row
        const sidInputRow = document.createElement('div');
        sidInputRow.className = 'input-row';
        
        const sidInput = document.createElement('input');
        sidInput.className = 'editable';
        sidInput.id = 'editableSid';
        sidInput.placeholder = 'Write your msg here';
        
        const sidSaveBtn = document.createElement('button');
        sidSaveBtn.className = 'save-btn';
        sidSaveBtn.id = 'saveSid';
        sidSaveBtn.textContent = 'Send';
        
        // Add input and button to the row
        sidInputRow.appendChild(sidInput);
        sidInputRow.appendChild(sidSaveBtn);
        // Add the row to the section
        sidSection.appendChild(sidInputRow);


        sidSaveBtn.addEventListener('click', async () => {
          const newValRaw = (sidInput.value || '').trim();
          if (!newValRaw) { alert('Please enter a valid value'); return; }
          const fullP = 'Sid= ' + newValRaw;
          const ok = await saveSidMsg(fullP);
          
          if (ok) {
            gsap.fromTo(sidSaveBtn, { scale: 0.98 }, { scale: 1.04, duration: 0.18, yoyo: true, repeat: 1 });
            sidDisplay.textContent = fullP;
            sidInput.value = '';
            spawnRoyalSparkles();
            alert('BINGO ✅.');
          } else { alert('Failed saving to server.'); }
        });
      }); 

      // 2. Type for Samaira (runs in parallel)
      typeWriterEffect(samairaData.msg, samairaDisplay, 30, () => {
        // NEW: Create input row
        const samairaInputRow = document.createElement('div');
        samairaInputRow.className = 'input-row';

        const samairaInput = document.createElement('input');
        samairaInput.className = 'editable';
        samairaInput.id = 'editableSamaira';
        samairaInput.placeholder = 'Write your msg here';
        
        const samairaSaveBtn = document.createElement('button');
        samairaSaveBtn.className = 'save-btn';
        samairaSaveBtn.id = 'saveSamaira';
        samairaSaveBtn.textContent = 'Send';
        
        // Add input and button to the row
        samairaInputRow.appendChild(samairaInput);
        samairaInputRow.appendChild(samairaSaveBtn);
        // Add the row to the section
        samairaSection.appendChild(samairaInputRow);

        samairaSaveBtn.addEventListener('click', async () => {
          const newValRaw = (samairaInput.value || '').trim();
          if (!newValRaw) { alert('Please enter a valid value'); return; }
          const fullP = 'Samaira= ' + newValRaw;
          const ok = await saveSamairaMsg(fullP);
          
          if (ok) {
            gsap.fromTo(samairaSaveBtn, { scale: 0.98 }, { scale: 1.04, duration: 0.18, yoyo: true, repeat: 1 });
            samairaDisplay.textContent = fullP;
            samairaInput.value = '';
            spawnRoyalSparkles();
            alert('BINGO ✅.');
          } else { alert('Failed saving to server.'); }
        });
      });
    }

    // --- UPDATED showError function ---
    function showError(errorMessage) {
      msg.textContent = errorMessage || 'Enter correct Contact No. Try again.'; // Show specific Firebase errors
      msg.style.display = 'block';
      statusDotsContainer.style.display = 'flex'; // Show dots
      
      // Make sure password input is visible on error
      pwd.style.display = 'block'; // or 'inline-block' etc.
      gsap.to(pwd, { opacity: 1, duration: 0.5 });
      pwdRow.classList.remove('unlocked'); // Remove centered class
      
      msg.style.opacity = 0;
      gsap.to(msg, { opacity: 1, y: -2, duration: 0.45, ease: 'power2.out' });
    }

    // --- *** COMPLETELY NEW Button Click Listener *** ---
    btn.addEventListener('click', () => {
      // Check current state by button text
      if (btn.textContent === 'Lock') {
          // --- LOCK THE PAGE (Sign Out) ---
          
          // NEW: Sign out from Firebase
          auth.signOut();
          
          // 1. Hide secret section smoothly
          gsap.to(secretEl, { opacity: 0, y: 8, duration: 0.5, ease: 'power3.in', onComplete: () => {
              secretEl.innerHTML = ''; // Clear the content
              secretEl.style.opacity = 0; // Reset for next time
              secretEl.style.transform = 'translateY(8px)';
          }});
          
          // 2. Show password input (it was hidden)
          pwd.style.display = 'block'; // or 'inline-block'
          gsap.to(pwd, { opacity: 1, duration: 0.5 });
          pwdRow.classList.remove('unlocked'); // Remove centered class
          
          // 3. Show dots
          statusDotsContainer.style.display = 'flex';
          gsap.to(statusDotsContainer, { opacity: 1, duration: 0.5 });
          
          // 4. Reset password field and focus
          pwd.value = '';
          pwd.focus();
          
          // 5. Change button text back
          btn.textContent = 'Go Ahead';
          
          // 6. Hide any error messages
          msg.style.display = 'none';
          
          return; // Stop
      }
      
      // --- GO AHEAD (Sign In) LOGIC ---
      const password = pwd.value.trim();
      if (!password) { pwd.focus(); return; }
      
      // Show loading state
      btn.textContent = 'Checking...';
      
      auth.signInWithEmailAndPassword(SHARED_EMAIL, password)
        .then((userCredential) => {
          // --- LOGIN SUCCESS ---
          showSecret(); // This shows the secret area
          
          // 1. Change button text
          btn.textContent = 'Lock';
          
          // 2. Hide password input ONLY
          gsap.to(pwd, { opacity: 0, duration: 0.5, onComplete: () => {
              pwd.style.display = 'none';
          }});
          
          // 3. Center the lock button
          pwdRow.classList.add('unlocked');
        })
        .catch((error) => {
          // --- LOGIN FAILED ---
          console.error("Login Error:", error.message);
          let friendlyError = 'Enter correct Contact No. Try again.';
          if (error.code === 'auth/wrong-password') {
            friendlyError = 'Enter correct Contact No. Try again.';
          } else if (error.code === 'auth/user-not-found') {
            friendlyError = 'User not found. Check Firebase setup.';
          }
          
          showError(friendlyError);
          btn.textContent = 'Go Ahead'; // Reset button text
        });
    });
    
    // --- UPDATED Keydown Listener ---
    pwd.addEventListener('keydown', (e) => { 
        // Only trigger on Enter if the button says "Go Ahead"
        if (e.key === 'Enter' && btn.textContent === 'Go Ahead') {
            btn.click(); 
        }
    });

    // ---------- UPDATED Royal particle system (canvas) ----------
    (function () {
      const canvas = document.getElementById('particles');
      const ctx = canvas.getContext('2d');
      let W = canvas.width = innerWidth;
      let H = canvas.height = innerHeight;
      const particles = []; // Renamed from 'animals'
      const palette = {
        gold: ['#f7d67b','#d4a017','#fff6d4'],
        maroon: ['#5a203a','#7a2e52'],
        green: ['#5cb85c', '#8FBC8F', '#3CB371'] // NEW: Leaf colors
      };
      function rand(min, max) { return Math.random() * (max - min) + min; }

      // --- Animal Functions (unchanged) ---
      function drawElephant(x, y, s, rot, fill) {
        ctx.save();
        ctx.translate(x, y); ctx.rotate(rot); ctx.scale(s, s);
        ctx.beginPath(); ctx.ellipse(0, 0, 28, 20, 0, 0, Math.PI*2); ctx.fillStyle = fill; ctx.fill();
        ctx.beginPath(); ctx.arc(36, -6, 12, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.moveTo(44, -2); ctx.quadraticCurveTo(56, 6, 52, 14);
        ctx.lineWidth = 3; ctx.strokeStyle = fill; ctx.stroke();
        ctx.beginPath(); ctx.moveTo(24, -12); ctx.quadraticCurveTo(10, -28, 2, -12);
        ctx.fillStyle = '#fff7e6'; ctx.fill();
        ctx.restore();
      }
      function drawPeacock(x, y, s, rot, fill) {
        ctx.save();
        ctx.translate(x, y); ctx.rotate(rot); ctx.scale(s, s);
        ctx.beginPath(); ctx.ellipse(0, 0, 10, 14, 0, 0, Math.PI*2); ctx.fillStyle = fill; ctx.fill();
        ctx.beginPath(); ctx.moveTo(6, -10); ctx.quadraticCurveTo(12, -22, 0, -26);
        ctx.strokeStyle = fill; ctx.lineWidth = 2; ctx.stroke();
        ctx.beginPath(); ctx.arc(0, -28, 4, 0, Math.PI*2); ctx.fill();
        for (let i = -5; i <= 5; i++) {
          ctx.beginPath(); ctx.moveTo(-4, 4);
          ctx.quadraticCurveTo(-32 + i*6, -10 + i*4, -8 - i*2, -24 + i*2);
          ctx.strokeStyle = 'rgba(255,235,180,0.9)'; ctx.lineWidth = 1.6; ctx.stroke();
        }
        ctx.restore();
      }
      
      // --- NEW: drawLeaf function ---
      function drawLeaf(x, y, s, rot, fill) {
          ctx.save();
          ctx.translate(x, y);
          ctx.rotate(rot);
          ctx.scale(s, s);
          ctx.beginPath();
          ctx.moveTo(0, 0);
          ctx.quadraticCurveTo(10, -10, 20, 0); // Top curve
          ctx.quadraticCurveTo(10, 10, 0, 0);  // Bottom curve
          ctx.fillStyle = fill;
          ctx.fill();
          ctx.restore();
      }

      function init() {
        particles.length = 0;
        const count = Math.round((W * H) / 60000) + 20; // More particles
        for (let i = 0; i < count; i++) {
          let type, fill;
          const r = Math.random();
          
          if (r < 0.33) {
            type = 'elephant';
            fill = palette.gold[Math.floor(rand(0, palette.gold.length))];
          } else if (r < 0.66) {
            type = 'peacock';
            fill = palette.gold[Math.floor(rand(0, palette.gold.length))];
          } else {
            type = 'leaf'; // Add leaves
            fill = palette.green[Math.floor(rand(0, palette.green.length))];
          }
          
          particles.push({
            type,
            x: rand(-W * 0.2, W * 1.2),
            y: rand(-H * 0.5, H * 1.2),
            vx: rand(-0.9, 0.9),
            vy: rand(0.4, 1.6),
            s: rand(0.6, 1.6),
            rot: rand(-0.6, 0.6),
            drot: rand(-0.02, 0.02),
            fill: fill
          });
        }
      }

      function draw() {
        ctx.clearRect(0, 0, W, H);
        ctx.fillStyle = 'rgba(250,240,230,0.02)';
        ctx.fillRect(0, 0, W, H);

        for (const p of particles) { // Renamed 'a' to 'p'
          if (p.type === 'elephant') drawElephant(p.x, p.y, p.s, p.rot, p.fill);
          else if (p.type === 'peacock') drawPeacock(p.x, p.y, p.s, p.rot, p.fill);
          else if (p.type === 'leaf') drawLeaf(p.x, p.y, p.s, p.rot, p.fill);

          p.x += p.vx;
          p.y += p.vy;
          p.rot += p.drot;

          if (p.y > H + 120) { p.y = -80; p.x = rand(-W * 0.1, W * 1.1); }
          if (p.x < -160) p.x = W + 160;
          if (p.x > W + 160) p.x = -160;
        }

        requestAnimationFrame(draw);
      }

      window.addEventListener('resize', () => { W = canvas.width = innerWidth; H = canvas.height = innerHeight; init(); });
      init(); draw();

      // royal sparkles on save
      function spawnRoyalSparkles() {
        const ccount = 10;
        for (let i = 0; i < ccount; i++) {
          const el = document.createElement('div');
          el.className = 'spark';
          const size = Math.round(rand(8, 26));
          el.style.width = el.style.height = size + 'px';
          el.style.left = (window.innerWidth / 2 + rand(-120, 120)) + 'px';
          el.style.top = (window.innerHeight / 2 + rand(-60, 60)) + 'px';
          el.style.background = `radial-gradient(circle at 30% 30%, rgba(255,250,230,0.95), rgba(212,160,40,0.95) 40%, transparent 60%)`;
          el.style.opacity = '0.98';
          el.style.borderRadius = '50%';
          document.body.appendChild(el);
          gsap.to(el, { y: rand(-140, -320), x: rand(-180, 180), scale: 1.1, opacity: 0, duration: 0.9 + Math.random() * 0.6, ease: 'power3.out', onComplete() { el.remove(); } });
        }
      }
      window.spawnRoyalSparkles = spawnRoyalSparkles;
    })();

    // UPDATED: micro-entrances (added more)
    gsap.from('.logo', { y: 28, opacity: 0, duration: 1.1, ease: 'power4.out' });
    gsap.from('#title', { y: 22, opacity: 0, duration: 1.2, delay: 0.08, ease: 'power4.out' });
    gsap.from('.card', { scale: 0.95, opacity: 0, duration: 1.3, delay: 0.18, ease: 'power4.out' });
    
    // NEW ANIMATIONS
    gsap.from('.pwd-row', { y: 20, opacity: 0, duration: 1.0, delay: 0.4, ease: 'power3.out' });
    gsap.from('.hint', { y: 10, opacity: 0, duration: 1.0, delay: 0.6, ease: 'power3.out' });
    gsap.from('.reveal', { y: 10, opacity: 0, duration: 1.0, delay: 0.7, ease: 'power3.out' });

    // focus
    pwd.focus();
  </script>
</body>
</html>
